{"version":3,"sources":["exfn/purchases/view.cljs"],"mappings":"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","names":["exfn.purchases.view/purchase-summary","cljs.core/deref","selected-store","re_frame.core.subscribe","selected-purchases","iter__5523__auto__","s__17383","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5521__auto__","size__5522__auto__","cljs.core/count","b__17385","cljs.core/chunk-buffer","i__17384","vec__17390","cljs.core/-nth","cljs.core.nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__17382","cljs.core/chunk-rest","vec__17395","cljs.core/first","cljs.core/cons","cljs.core/rest","purchase","id","cljs.core.sort_by","cljs.core/second","cljs.core/zipmap","cljs.core.range","exfn.month.logic/format-date","exfn.shared.logic/format-number","exfn.purchases.view/view","map__17404","cljs.core/--destructure-map","cljs.core.get","purchases","error","loading?","show-full-year?","sort-col","sort-asc?","exfn.shared.error/error-indicator","exfn.shared.loading/loading","re-frame.core/dispatch-sync","cljs.core._EQ_","s__17408","b__17410","i__17409","map__17416","iter__17407","map__17418","store","total","exfn.purchases.logic/get-store-icon","cljs.core.map","cljs.core.reduce","cljs.core/+","cljs.core/chunk-first"],"sourcesContent":["(ns exfn.purchases.view\n  (:require [exfn.purchases.subscriptions]\n            [reagent.core :as r]\n            [exfn.purchases.logic :as lgc]\n            [exfn.month.logic :as mlgc]\n            [exfn.purchases.events]\n            [re-frame.core :as rf]\n            [goog.string :as gstring]\n            [exfn.shared.error :as err]\n            [exfn.shared.loading :as loading]\n            [goog.string.format]\n            [exfn.shared.logic :as slgc]))\n\n(defn purchase-summary []\n  (let [selected-store @(rf/subscribe [:selected-store])\n        selected-purchases @(rf/subscribe [:store-summary])]\n    [:div\n     [:div.row.selected-store\n      selected-store]\n     [:div.table-responsive\n      [:table.table.table-striped.table-sm.table-hover\n       [:thead\n        [:tr\n         [:td \"Date\"]\n         [:td \"Account\"]\n         [:td \"Narrative\"]\n         [:td.amount-col \"Amount\"]]]\n       [:tbody\n        (for [[purchase id] (sort-by second (zipmap selected-purchases (range)))]\n          [:tr\n           {:key (str \"sel-pur-\" id)}\n           [:td (mlgc/format-date (purchase :date))]\n           [:td (purchase :narrative)]\n           [:td (purchase :account-name)]\n           [:td.amount-col\n            (slgc/format-number (purchase :amount))]])]]]]))\n\n(defn view []\n  (let [purchases @(rf/subscribe [:purchases])\n        error     @(rf/subscribe [:error])\n        loading? @(rf/subscribe [:loading?])\n        show-full-year? @(rf/subscribe [:show-full-year-purchases?])\n        {:keys [sort-col sort-asc?]} @(rf/subscribe [:purchases-sort])]\n    [:main.col-md-9.ms-sm-auto.col-lg-10.px-md-4\n     [:div.d-flex.justify-content-between.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom\n      [:h1.h2 \"Purchases\"]]\n     (cond\n       error [err/error-indicator error :purchase]\n       loading? [loading/loading loading?]\n       :else\n       [:div.row\n        [:div.col.col-lg-6\n         [:div {:style {:width 300}}\n          [:div.table-responsive\n           [:table.table.table-striped.table-sm.table-hover\n            [:thead\n             [:tr\n              [:th \"\"]\n              [:th.clickable-header\n               {:on-click #(rf/dispatch-sync [:purchases-sort :store])}\n               [:span\n                \"Store   \"\n                (when (= sort-col :store)\n                  (if sort-asc?\n                    [:i.fas.fa-angle-down]\n                    [:i.fas.fa-angle-up]))]]\n              [:th.amount-col.clickable-header\n               [:span\n                {:on-click #(rf/dispatch-sync [:purchases-sort :total])}\n                \"Total   \"\n                (when (= sort-col :total)\n                  (if sort-asc?\n                    [:i.fas.fa-angle-down]\n                    [:i.fas.fa-angle-up]))]]]]\n            [:tbody\n             (for [{:keys [store total]} purchases]\n               [:tr\n                {:key (str \"st-\" store)}\n                [:td {:style {:width 50}} (lgc/get-store-icon store)]\n                [:td {:style {:width 250 :cursor :pointer}\n                      :on-click (fn []\n                                  (rf/dispatch-sync [:get-store-summary store]))} store]\n                [:td.amount-col \n                 {:style {:cursor :pointer}\n                  :on-click (fn []\n                              (rf/dispatch-sync [:get-store-summary store]))}\n                 (slgc/format-number total)]])\n             [:tr.total-row.table-primary\n              [:td]\n              [:td]\n              [:td.amount-col\n               {:style {:width 100}}\n               (slgc/format-number\n                (->> purchases\n                     (map :total)\n                     (reduce +)))]]\n             [:tr\n              [:td {:colspan 2\n                    :style {:text-align :right}}\n               \"Show full year?\"]\n              [:td.amount-col\n               {:style {:width 100}}\n               [:div.form-check.form-switch\n                [:input.form-check-input\n                 {:role :switch\n                  :type :checkbox\n                  :checked show-full-year?\n                  :on-change (fn []\n                               (rf/dispatch-sync [:toggle-full-year]))}]]]]]]]]]\n        [:div.col.col-lg-4\n         [purchase-summary]]\n        [:div.col.col-lg-2]])]))"]}